/** * @package Feedback * @version 1.1.0 * @author Sergey Osipov <info@devstratum.ru> * @website https://devstratum.ru * @copyright (c) 2023 Sergey Osipov. All Rights Reserved * @license GNU GPL v2.0 * @report https://github.com/devstratum/feedback/issues */
document.addEventListener("DOMContentLoaded",function(){let e=document.querySelectorAll(".mod-feedback__privacy .privacy-checkbox");e.forEach(function(e){e.addEventListener("click",function(){var e=this.getAttribute("data-form-id");let t=document.getElementById("mod_feedback_"+e),o=t.querySelector(".mod-feedback__submit .button-submit");this.classList.contains("checked")?(this.classList.remove("checked"),o.classList.add("disabled"),o.setAttribute("disabled","1")):(this.classList.add("checked"),o.classList.remove("disabled"),o.removeAttribute("disabled"))})});let t=document.querySelectorAll(".mod-feedback__submit .button-submit");function i(e,t){let o=document.getElementById("mod_feedback_"+e),d=o.querySelector(".mod-feedback__alert");if(d.innerHTML='<div class="mod-alert mod-alert-'+t.type+'">'+t.text+"</div>","success"===t.type){let e=o.querySelectorAll(".mod-feedback__fields .mod-input");e.forEach(function(e){e.value=""}),t.redirect&&setTimeout(function(){location.href=t.redirect},300)}}t.forEach(function(e){e.addEventListener("click",function(){var e=this.getAttribute("data-form-id");this.getAttribute("disabled")||function(t){let e=document.getElementById("mod_feedback_"+t),o=e.querySelectorAll(".mod-input"),d=e.querySelector(".mod-feedback__submit .button-submit"),r=e.querySelector(".mod-feedback__progress"),c={};d.classList.add("freeze"),d.setAttribute("disabled","1"),r.classList.add("active"),o.forEach(function(e){"file"!==e.getAttribute("type")&&(c[e.getAttribute("name")]=e.value)}),setTimeout(function(){var d,e;d=t,e=c,Joomla.request({url:"?option=com_ajax&module=feedback&format=json",method:"POST",headers:{"Cache-Control":"no-cache","Content-Type":"application/json"},data:JSON.stringify({mod_id:d,fields:e}),onBefore:function(){},onSuccess:function(e){e=JSON.parse(e);0!==e.length&&(function(){let e=document.getElementById("mod_feedback_"+d),t=e.querySelector(".mod-feedback__alert"),o=e.querySelectorAll(".mod-feedback__field");t.innerHTML="",o.forEach(function(e){e.querySelector(".mod-feedback__input").classList.remove("error"),e.querySelector(".mod-feedback__error").textContent=""})}(),i(d,e.message),function(e,t){if(0!==t.length&&t.errors){let d=document.getElementById("mod_feedback_"+e);t.errors.forEach(function(e){let t=d.querySelector(".feedback-field_"+e.key+" .mod-feedback__input"),o=d.querySelector(".feedback-field_"+e.key+" .mod-feedback__error");t.classList.add("error"),o.textContent=e.error})}}(d,e.data))},onError:function(){i(d,{type:"danger",text:"Error: unable to send a message"})},onComplete:function(){let e=document.getElementById("mod_feedback_"+d),t=e.querySelector(".mod-feedback__submit .button-submit"),o=e.querySelector(".mod-feedback__progress");t.classList.remove("freeze"),t.removeAttribute("disabled"),o.classList.remove("active")}})},200)}(e)})})});